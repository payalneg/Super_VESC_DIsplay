# üöÄ VESC SDK Integration Guide

## ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–¢–µ–ø–µ—Ä—å –≤–∞—à –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É VESC CAN SDK** –æ—Ç [waas-rent](https://github.com/waas-rent/vesc_can_sdk.git) –≤–º–µ—Å—Ç–æ —Å–∞–º–æ–¥–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚úÖ **–ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º VESC
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ CAN —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥** –¥–∞–Ω–Ω—ã—Ö VESC
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥** VESC CAN –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤

## üîß –ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∏–Ω—ã (–ø–æ –≤–∞—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º):
```
ESP32-S3     CAN Transceiver     VESC
GPIO 6   ‚Üí   CTX (TX)        
GPIO 0   ‚Üê   CRX (RX)        
3.3V     ‚Üí   VCC             
GND      ‚Üí   GND             
         ‚Üí   CAN_H           ‚Üí   CAN_H
         ‚Üí   CAN_L           ‚Üí   CAN_L
         ‚Üí   GND             ‚Üí   GND
```

### ‚ö†Ô∏è –í–∞–∂–Ω–æ: CAN Speed = 250 –∫–±–∏—Ç/—Å
–ö–æ–¥ —Ç–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **250 –∫–±–∏—Ç/—Å** –≤–º–µ—Å—Ç–æ 500 –∫–±–∏—Ç/—Å. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ VESC –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Ç—É –∂–µ —Å–∫–æ—Ä–æ—Å—Ç—å!

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VESC

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ VESC –∫ –∫–æ–º–ø—å—é—Ç–µ—Ä—É —á–µ—Ä–µ–∑ USB**
2. **–û—Ç–∫—Ä–æ–π—Ç–µ VESC Tool**
3. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ App Settings ‚Üí CAN**
4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:**
   - CAN ID: **0**
   - CAN Baud Rate: **250k** (–≤–∞–∂–Ω–æ!)
   - Send Status: **Rate 1** (–≤–∫–ª—é—á–∏—Ç—å)
   - CAN Status Rate 1: **50 Hz**
   - CAN Status Rate 2: **10 Hz**
   - CAN Status Rate 3: **10 Hz**
   - CAN Status Rate 4: **10 Hz**
   - CAN Status Rate 5: **10 Hz**

5. **–ù–∞–∂–º–∏—Ç–µ "Write Configuration"**
6. **–û—Ç–∫–ª—é—á–∏—Ç–µ USB, –ø–æ–¥–∫–ª—é—á–∏—Ç–µ CAN**

## üöÄ –ß—Ç–æ —É–º–µ–µ—Ç –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞

### –ü–æ–ª–Ω–∞—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è VESC:
- **–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: RPM, —Ç–æ–∫, –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, duty cycle
- **–≠–Ω–µ—Ä–≥–∏—è**: –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–Ω—ã–µ Ah –∏ Wh
- **–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã**: FET –∏ –º–æ—Ç–æ—Ä–∞
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –∫–æ–¥—ã –æ—à–∏–±–æ–∫, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
- **–†–∞—Å—á–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**: —Å–∫–æ—Ä–æ—Å—Ç—å, –º–æ—â–Ω–æ—Å—Ç—å, –∑–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ—Ç–æ—Ä–æ–º:
- **Duty cycle control** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—É –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- **Current control** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ —Ç–æ–∫—É
- **RPM control** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ –æ–±–æ—Ä–æ—Ç–∞–º
- **Brake control** - —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ —Ç–æ–∫–æ–º

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
- **Ping/Pong** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏
- **Status requests** - –∑–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞
- **Error handling** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ CAN —à–∏–Ω—ã
- **Connection monitoring** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
```cpp
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
bool VESC_SDK_Init(uint8_t vesc_id = 0);

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–≤ loop)
void VESC_SDK_Loop();

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
bool VESC_SDK_IsConnected();

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
vesc_sdk_values_t VESC_SDK_GetValues();

// –ü—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
float VESC_SDK_GetSpeed();           // –∫–º/—á
float VESC_SDK_GetBatteryVoltage();  // –≤–æ–ª—å—Ç—ã
float VESC_SDK_GetBatteryPercentage(); // –ø—Ä–æ—Ü–µ–Ω—Ç—ã
float VESC_SDK_GetMotorCurrent();    // –∞–º–ø–µ—Ä—ã
float VESC_SDK_GetPower();           // –≤–∞—Ç—Ç—ã
float VESC_SDK_GetTempFET();         // ¬∞C
float VESC_SDK_GetTempMotor();       // ¬∞C

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ—Ç–æ—Ä–æ–º (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
void VESC_SDK_SetDuty(float duty_cycle);      // -1.0 –¥–æ 1.0
void VESC_SDK_SetCurrent(float current);      // –∞–º–ø–µ—Ä—ã
void VESC_SDK_SetBrakeCurrent(float current); // –∞–º–ø–µ—Ä—ã —Ç–æ—Ä–º–æ–∂–µ–Ω–∏—è
void VESC_SDK_SetRPM(float rpm);              // –æ–±–æ—Ä–æ—Ç—ã –≤ –º–∏–Ω—É—Ç—É

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
void VESC_SDK_EmergencyStop();       // —ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞

// –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
void VESC_SDK_Ping();                // ping
void VESC_SDK_RequestValues();       // –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
void VESC_SDK_PrintDebug();          // –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```cpp
void loop() {
    VESC_SDK_Loop();  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ –∫–∞–∂–¥–æ–º —Ü–∏–∫–ª–µ!
    
    if (VESC_SDK_IsConnected()) {
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        float speed = VESC_SDK_GetSpeed();
        float battery = VESC_SDK_GetBatteryVoltage();
        float power = VESC_SDK_GetPower();
        
        Serial.printf("Speed: %.1f km/h, Battery: %.1fV, Power: %.0fW\n", 
                      speed, battery, power);
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
        if (speed < 5.0f) {  // —Ç–æ–ª—å–∫–æ –Ω–∞ –º–∞–ª–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
            VESC_SDK_SetDuty(0.1f);  // 10% –º–æ—â–Ω–æ—Å—Ç–∏
        }
    } else {
        Serial.println("VESC disconnected");
    }
    
    delay(100);
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä
–ó–∞–≥—Ä—É–∑–∏—Ç–µ `examples/VESC_SDK_Test.ino` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

### 2. Serial Monitor –∫–æ–º–∞–Ω–¥—ã
–í Serial Monitor (115200 baud) –¥–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã:
- **`d`** - Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **`s`** - Status VESC
- **`p`** - Ping VESC
- **`v`** - Request values
- **`e`** - Emergency stop
- **`h`** - Help

### 3. –û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
```
VESC SDK: TWAI driver installed successfully
VESC SDK: TWAI driver started successfully
VESC SDK: CAN SDK initialized successfully
VESC SDK initialized for VESC ID: 0
CAN TX Pin: 6, CAN RX Pin: 0
CAN Speed: 250 kbps
```

–ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ VESC:
```
VESC SDK: Received response from ID 0, command 4, len 61
VESC SDK: Parsed GET_VALUES successfully
VESC SDK: 0.0 km/h | 42.0V (85%) | 0W | FET:25¬∞C Motor:23¬∞C
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### ‚ùå "Failed to initialize CAN SDK"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `vesc_can_sdk` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ `platformio.ini`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∏–Ω—ã GPIO 6/0 —Å–≤–æ–±–æ–¥–Ω—ã

### ‚ùå "VESC SDK: Disconnected"
- **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ CAN —Å–∫–æ—Ä–æ—Å—Ç—å**: VESC –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ 250 –∫–±–∏—Ç/—Å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ CAN —Ç—Ä–∞–Ω—Å–∏–≤–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ VESC –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### ‚ùå "Bus error occurred"
- –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑–∏—Å—Ç–æ—Ä—ã 120 –û–º –Ω–∞ –∫–æ–Ω—Ü–∞—Ö CAN —à–∏–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π CAN_H –∏ CAN_L
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∏—Ç–∞–Ω–∏–µ CAN —Ç—Ä–∞–Ω—Å–∏–≤–µ—Ä–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ

### ‚ùå "Transmission failed"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ CAN —Ç—Ä–∞–Ω—Å–∏–≤–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ ESP32
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ VESC –≤–∫–ª—é—á–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—Ä–∏–µ–º CAN –∫–æ–º–∞–Ω–¥

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ SDK

### –ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Å–∞–º–æ–¥–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π:

| –§—É–Ω–∫—Ü–∏—è | –°–∞–º–æ–¥–µ–ª—å–Ω–∞—è | VESC SDK |
|---------|-------------|----------|
| –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π | –ë–∞–∑–æ–≤—ã–π | –ü–æ–ª–Ω—ã–π |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | –ü—Ä–æ—Å—Ç–∞—è | –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–º–∞–Ω–¥ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è | –í—Å–µ –∫–æ–º–∞–Ω–¥—ã |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –ß–∞—Å—Ç–∏—á–Ω–∞—è | 100% |
| –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∞—è |
| –û—Ç–ª–∞–¥–∫–∞ | –ë–∞–∑–æ–≤–∞—è | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è |

### –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ **–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** –≤—Å–µ—Ö VESC CAN —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥** —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –æ—à–∏–±–æ–∫ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- ‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å –±—É–¥—É—â–∏–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ VESC

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥** –≤ ESP32-S3
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ VESC –Ω–∞ 250 –∫–±–∏—Ç/—Å** (–≤–∞–∂–Ω–æ!)
3. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ CAN —Ç—Ä–∞–Ω—Å–∏–≤–µ—Ä** –∫ –ø–∏–Ω–∞–º 6/0
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Serial Monitor** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π SDK
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VESC —á–µ—Ä–µ–∑ CAN —à–∏–Ω—É, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É SDK. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–º–Ω–æ–≥–æ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ!

**–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å CAN –≤ VESC Tool –Ω–∞ 250 –∫–±–∏—Ç/—Å!**
